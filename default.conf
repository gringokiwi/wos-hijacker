server {
    listen 8080;
    server_name _;
    
    # Health check for Railway
    location /health {
        return 200 "OK\n";
        add_header Content-Type text/plain;
    }
    
    # Lightning address endpoint - fetch from .com and return
    location ~ ^/\.well-known/lnurlp/(\w+)$ {
        set $username $1;
        
        # Log the redirect for monitoring
        access_log /usr/local/openresty/nginx/logs/redirect.log main;
        
        # Execute Lua script to fetch and return response
        content_by_lua_file /usr/local/openresty/nginx/conf/fetch.lua;
    }
    
    # Catch-all for any other requests
    location / {
        return 301 https://walletofsatoshi.com$request_uri;
    }
}